<!DOCTYPE html>
<html>
<head>
    <title>Formulario con Recaptcha</title>
</head>
<body>
    <h1>Formulario de Contacto</h1>
    <form onsubmit="return validarFormulario()" action="procesar_formulario.php" method="post">
        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" name="nombre" required>
        <br>
        <label for="apellido">Apellido:</label>
        <input type="text" id="apellido" name="apellido" required>
        <br>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
        <br>
        <label for="mensaje">Mensaje:</label>
        <textarea id="mensaje" name="mensaje" required></textarea>
        <br>
        <h2>Resuelve la siguiente operación:</h2>
        <div id="recaptcha"></div>
        <br>
        <input type="text" id="respuesta" placeholder="Ingresa tu respuesta">
        <button type="button" onclick="reiniciarCaptcha()">Reiniciar Captcha</button>
        <br>
        <button type="submit" id="enviar" disabled>Enviar</button>
        <p id="mensajeCaptcha"></p>
    </form>

    <script>
        let respuestaCorrecta;

        function generarOperacion() {
            const num1 = Math.floor(Math.random() * 10) + 1; // Número entero positivo entre 1 y 10
            const num2 = Math.floor(Math.random() * 10) + 1; // Número entero positivo entre 1 y 10
            const operaciones = ['+', '*', '-'];
            const operacion = operaciones[Math.floor(Math.random() * operaciones.length)];

            let resultado;
            switch (operacion) {
                case '+':
                    resultado = num1 + num2;
                    break;
                case '*':
                    resultado = num1 * num2;
                    break;
                case '-':
                    resultado = num1 - num2;
                    break;
            }

            respuestaCorrecta = resultado;
            return `${num1} ${operacion} ${num2}`;
        }

        function reiniciarCaptcha() {
            const pregunta = generarOperacion();
            document.getElementById('recaptcha').innerHTML = pregunta;
            document.getElementById('respuesta').value = ''; // Clear the input field
        }

        function validarRespuesta() {
            const respuestaUsuario = parseInt(document.getElementById('respuesta').value);
            const enviarButton = document.getElementById('enviar');
            enviarButton.disabled = isNaN(respuestaUsuario) || respuestaUsuario !== respuestaCorrecta;
        }

        function validarFormulario() {
            const respuestaUsuario = parseInt(document.getElementById('respuesta').value);
            if (isNaN(respuestaUsuario)) {
                document.getElementById('mensajeCaptcha').innerText = 'Por favor, ingresa una respuesta válida.';
                return false;
            }

            if (respuestaUsuario === respuestaCorrecta) {
                document.getElementById('mensajeCaptcha').innerText = '';
                alert('Enviado');
                return true; // Permite el envío del formulario
            } else {
                document.getElementById('mensajeCaptcha').innerText = 'Captcha incorrecto.';
                reiniciarCaptcha(); // Generate a new operation and clear the input field
                return false; // Evitar el envío del formulario
            }
        }

        window.onload = function() {
            reiniciarCaptcha();
            const respuestaInput = document.getElementById('respuesta');
            respuestaInput.addEventListener('input', validarRespuesta); // Add event listener for input changes in the answer
        };
    </script>
</body>
</html>
